name: Commit Checks

on:
  push:
    branches:
      - '*'
  workflow_call:

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”€ checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ðŸ“¦ setup pdm
        uses: pdm-project/setup-pdm@v4
        with:
          cache: true

      - name: ðŸ“¦ install dependencies
        run: |
          pdm install

      - name: ðŸ§ª run tests
        id: test
        run: |
          pdm run pytest -v
  coverage:
    name: Check coverage
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”€ checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ðŸ“¦ setup pdm
        uses: pdm-project/setup-pdm@v4
        with:
          cache: true

      - name: ðŸ“¦ install dependencies
        run: |
          pdm install

      - name: ðŸ§ª run tests
        id: test
        run: |
          pdm run pytest -v --cov

      - name: ðŸ“Š generate coverage report
        if: always()
        run: |
          echo "### ðŸ“Š Coverage Report" >> $GITHUB_STEP_SUMMARY
          echo "```" >> $GITHUB_STEP_SUMMARY
          pdm run coverage report >> $GITHUB_STEP_SUMMARY
          echo "```" >> $GITHUB_STEP_SUMMARY
